# TrueBlocks Mini-DApps Copilot Instructions

## Project Architecture

This is a **Go workspace** (`go.work`) mono-repository with git submodules for shared libraries. The core pattern is:

- `libs/` - Git submodules containing shared libraries (trueblocks-sdk v5, trueblocks-dalle v2)
- `explorer/`, `namester/` - Individual Wails applications with `/v2` module versioning
- `bin/` - Built binaries (generated by `make build`)

**Critical**: Each app/library uses semantic import versioning (`/v2`, `/v5`). New apps must follow this pattern:
```go
module github.com/TrueBlocks/appname/v2
```

## Development Workflow

Use **Makefile commands** instead of direct go commands:

```bash
make build          # Builds all apps to bin/
make test           # Tests all modules
make check          # Format + test + build (CI equivalent)
make fmt            # Formats all code in workspace
make lint           # Requires golangci-lint installation
make update         # Updates git submodules
make explorer/namester  # Build and run specific app
```

## Library Integration Patterns

### SDK Import Pattern
```go
import (
    "github.com/TrueBlocks/trueblocks-core/src/apps/chifra/pkg/base"
    sdk "github.com/TrueBlocks/trueblocks-sdk/v5"
    "github.com/TrueBlocks/trueblocks-dalle/v2/pkg/dalle"
)
```

### TrueBlocks SDK Usage
- All SDK calls follow `[Module]Options` struct pattern (e.g., `WhenOptions`, `InitOptions`)
- Methods return `([]ResultType, *types.MetaData, error)` tuples
- SDK provides blockchain data access via the TrueBlocks Core backend

### DALL-E Library Pattern
- Context-driven architecture with centralized `Context` struct managing templates, databases, cache
- Package structure: `pkg/[image|model|prompt|storage|utils]`
- OpenAI integration for prompt enhancement and image generation
- Progress tracking with phase-based reporting and ETA calculation

## CI/CD Integration

**GitHub Actions** expects:
- `submodules: recursive` in checkout (critical for submodules)
- All tests must pass for successful builds
- Artifacts uploaded to `bin/` on successful builds
- Format checking with `make fmt && git diff --exit-code`

## Submodule Management

Submodules in `libs/` are **actively developed** as part of this workspace:
- Modify submodule content directly as needed for development
- Use `make update` or `git submodule update --remote` to sync with upstream
- Submodules allow coordinated development across the TrueBlocks ecosystem
- Changes in submodules should be committed and pushed to their respective repos

## VS Code Optimization

This workspace uses **performance-optimized gopls settings** in `.vscode/settings.json`:
- Disabled expensive analyses (fillstruct, staticcheck, etc.)
- Reduced completion budget and diagnostic delays
- Optimized for 600+ dependencies from blockchain libraries

If gopls becomes unresponsive: Use "Go: Restart Language Server" command.

## Module Versioning Strategy

- **Main repo**: `/v2` for applications
- **SDK**: `/v5` (auto-generated from TrueBlocks Core)  
- **DALL-E**: `/v2` (custom AI/image library)

When adding new apps, initialize with:
```bash
go mod init github.com/TrueBlocks/newapp/v2
go mod edit -go=1.25.1
# Add to go.work: use ./newapp
```

## Testing Patterns

- All tests should pass across applications and libraries
- Use `make test` to run the full test suite
- Focus on maintaining test quality in both applications and libraries
- CI requires all tests to pass for successful builds

## Key Dependencies

- **TrueBlocks Core**: Blockchain indexing and data access
- **Ethereum libraries**: go-ethereum, various crypto libs
- **AI/Image**: OpenAI API, gg graphics, go-colorful
- **IPFS**: For decentralized storage integration

## Build Artifacts

- Binaries built to `bin/` directory
- CI uploads artifacts with 7-day retention
- Use `make clean` to remove build artifacts
- Release process triggered by `v*` tags